```sh
#! /bin/bash

line=`cat ./conf |grep line |grep -v "#" |awk -F"=" '{print $2}' |sed 's/ //g'`

space(){
ssh xxx@xxx<<END
        source ~/.profile
        kinit -kt xxx.keytab xxxx
        hdfs dfsadmin -report | grep "DFS Used%"

END
}

used=`space | awk -F": " '{print $2}' | sed 's/%$//g' |awk -v use=$line '$1>use{print}'`

if [[ $used != "" ]]
then
        sh msg-sender.sh "集群HDFS使用率为：${used}%，已达告警阈值"
else
        echo "现在集群使用率正常！"
fi
```

```sh
#! /bin/bash

#判断参数
if [[ $# == 0 ]]
then
        echo "参数不足，请重新执行"
        sleep 3
        exit 1
fi

#短信内容若包含单双引号反引号等特殊字符的，需要用反斜杠转义，需要用双引号囊括内容整体
content=$1

#获取程序所在路径
path=$(cd "$(dirname "$0")";pwd)

#配置联系人列表
function contanctor_conf()
{
        echo "你还没有设置短信联系人，点回车开始配置联系人信息"
        read a
        echo -e "#配置短信联系人\n" >>${path}/mobileTables
        vi ${path}/mobileTables
}

#读取联系人列表，mobile代表获取手机号列表，name代表获取姓名列表
function x()
{
        opt=$1
        s=""
        case $opt in
        mobile)
                list=`cat ${path}/mobileTables |grep -v "#" |awk '{print $2}'`
                ;;
        name)
                list=`cat ${path}/mobileTables |grep -v "#" |awk '{print $1}'`
                ;;
        esac
        for num in $list
        do 
                s+=$num
                s+=";"
        done
        echo $s |sed 's/;$//g'

}

#根据提供的参数生成xml格式报文
function xml_editor()
{
        contacters=$(x mobile)
        echo "<?xml version=\"1.0\" encoding=\"utf-8\"?>" >${path}/sendmsg.xml
        echo " <soap:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\">" >>${path}/sendmsg.xml
        echo " <soap:Body>" >>${path}/sendmsg.xml
        echo " <SendSMS xmlns=\"DIQuestion\">" >>${path}/sendmsg.xml
        echo " <mobile>"${contacters}"</mobile>" >> ${path}/sendmsg.xml
        echo " <content>"$content >>${path}/sendmsg.xml
        echo "[运维]</content>" >>${path}/sendmsg.xml
        echo " </SendSMS>" >>${path}/sendmsg.xml
        echo " </soap:Body>" >>${path}/sendmsg.xml
        echo "</soap:Envelope>" >>${path}/sendmsg.xml
}

#判断程序目录下有没有特定目录，没有则创建
function dir_maker()
{
        if [[ ! -d ${path}/$1 ]]
        then
                mkdir -p ${path}/$1
        fi
}

#尝试发送短信报文xml文件
function sender()
{
        xml_editor
        curl -X POST -H 'Content-Type: text/xml; charset=utf-8' -d @${path}/sendmsg.xml xxxx
}

#主方法
function main()
{
        if [[ ! -f ${path}/mobileTables ]]
        then
                contanctor_conf
                sleep 1
        fi
        dir_maker logs
        result=$(sender sed 's/></>\r\n</g' |grep "true" |wc -l)

        if [[ ${result} == 1 ]]
        then
                echo "`date +%Y-%m-%d" "%H:%M:%S`已发送短信$content给下列人员："$(x name) | tee ${path}/logs/msg_`date +%Y%m%d%H%M%S`.log
                rm ${path}/sendmsg.xml
                exit 0
        else
                echo "`date +%Y-%m-%d" "%H:%M:%S`发送短信失败" | tee ${path}/logs/msg_`date +%Y%m%d%H%M%S`.log
                exit 1
        fi
}

#执行
main
```
